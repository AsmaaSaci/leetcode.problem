public class Solution {
    public int[] PrisonAfterNDays(int[] cells, int n) {
        Dictionary<int, int> map = new();
        bool flag = false;
        while(n-->0)
        {
            cells = NextDay(cells);
            int num = ArrayToNum(cells);
            if(!flag)
            {
                if(map.ContainsKey(num))
                {
                    n %= (map[num]-n);
                    flag = true;
                }
                else
                {
                    map.Add(num, n);
                }
            }
        }

        return cells;
    }

    int ArrayToNum(int[] cells)
    {
        int res = 0;
        for(int i = 0;i<cells.Length;i++)
        {
            res += cells[i]* (int)(Math.Pow(2, i));
        }
        return res;
    }

    int[] NextDay(int[] cells)
    {
        int[] newCells = new int[cells.Length];

        newCells[0] = 0;
        for(int i = 1;i<cells.Length-1;i++)
        {
            newCells[i] = cells[i-1]==cells[i+1]?1:0;
        }
        newCells[cells.Length-1] = 0;

        return newCells;
    }
}
