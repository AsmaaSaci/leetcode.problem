public class Solution {
    private long GCD(long a, long b)
    {
        if(a == 0 || b == 0)
            return a | b;
        else if(a == b)
            return a;
        else if(a > b)
            return GCD(a%b, b);
        else
            return GCD(b%a, a);
    }

    private long LCM(long a, long b)
    {
        return a*b/GCD(a, b);
    }

    private long lcm_ab;
    private long lcm_bc;
    private long lcm_ac;
    private long lcm_abc;

    private void BuildLCM(long a, long b, long c)
    {
        lcm_ab = LCM(a, b);
        lcm_ac = LCM(a, c);
        lcm_bc = LCM(b, c);
        lcm_abc = LCM(lcm_ab, c);
    }

    private long UglyCnt(long mid, int a, int b, int c)
    {
        long cnt = mid/a + mid/b+mid/c - mid/lcm_ab - mid/lcm_bc - mid/lcm_ac + mid/lcm_abc;
        return cnt;
    }

    public int NthUglyNumber(int n, int a, int b, int c) {
        long low = Math.Min(a, Math.Min(b, c)), high = low*n;
        BuildLCM(a, b, c);
        
        while(low <= high)
        {
            long mid = low + (high - low)/2;
            long curUglyCnt = UglyCnt(mid, a, b, c);
            if(curUglyCnt >= n)
                high = mid - 1;
            else
                low = mid + 1;
        }

        return (int)low;
    }
}
