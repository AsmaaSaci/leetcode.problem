public class Solution {
    public int MaxNumberOfAlloys(int n, int k, int budget, IList<IList<int>> composition, IList<int> stock, IList<int> cost) {
        var result = 0;

        for (var i = 0; i < k; i++) // iterate over machines
        {
            long min = 0, max = int.MaxValue - 1; // initialize min and max alloys count 
            while (min < max)
            {
                var middle = (min + max + 1) / 2; // current number of alloys we try to produce
                var details = composition[i].Select(x => middle * x).ToArray(); // counting amount of each metal to complete alloy

                long sum = 0;
                for (var j = 0; j < n; j++)
                {
                    details[j] = Math.Max(0, details[j] - stock[j]); // counting amount of each metal needed to pay for
                    sum += (details[j] * cost[j]); // summing up
                }

                if (sum <= budget)
                {
                    min = middle;
                }
                else
                {
                    max = middle - 1;
                }
            }

            result = (int)Math.Max(result, min); // changing the result
        }
        
        return result;
    }
}
