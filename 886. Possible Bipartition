public class Solution
{
    public bool PossibleBipartition(int N, int[][] dislikes)
    {
        var graph = new List<int>[N + 1];
        for (var i = 1; i <= N; i++)
        {
            graph[i] = new List<int>();
        }

        foreach (var dislike in dislikes)
        {
            graph[dislike[0]].Add(dislike[1]);
            graph[dislike[1]].Add(dislike[0]);
        }

        var colors = new int[N + 1];
        for (var i = 1; i <= N; i++)
        {
            if (colors[i] == 0 && !DFS(graph, colors, i, 1))
            {
                return false;
            }
        }

        return true;
    }

    private bool DFS(List<int>[] graph, int[] colors, int node, int color)
    {
        if (colors[node] != 0)
        {
            return colors[node] == color;
        }

        colors[node] = color;
        foreach (var neighbor in graph[node])
        {
            if (!DFS(graph, colors, neighbor, -color))
            {
                return false;
            }
        }

        return true;
    }
}
