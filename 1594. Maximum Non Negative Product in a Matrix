public class Solution {
    public int MaxProductPath(int[][] grid) {
        int m = grid.Length;
        int n = grid[0].Length;
        int MOD = 1000000007;

        long[,,] dp = new long[m, n, 2];

        for (int i = 0; i < m; i++){
            for (int j = 0; j< n; j++) {
                if (i == 0 && j == 0) {
                    dp[i,j,0] = grid[i][j];
                    dp[i,j,1] = grid[i][j];
                }
                else if (i == 0) {
                    dp[i,j,0] = grid[i][j] * dp[i,j-1,0];
                    dp[i,j,1] = grid[i][j] * dp[i,j-1,0];
                }
                else if (j == 0) {
                    dp[i,j,0] = grid[i][j] * dp[i-1,j,0];
                    dp[i,j,1] = grid[i][j] * dp[i-1,j,0];
                }
                else {
                    long a = grid[i][j] * dp[i-1,j,0];
                    long b = grid[i][j] * dp[i-1,j,1];
                    long c = grid[i][j] * dp[i,j-1,0];
                    long d = grid[i][j] * dp[i,j-1,1];

                    dp[i,j,0] = Math.Max(Math.Max(a, b), Math.Max(c, d));
                    dp[i,j,1] = Math.Min(Math.Min(a, b), Math.Min(c, d));
                }
            }
        }

        return dp[m-1,n-1,0] >= 0 ? (int)(dp[m-1,n-1,0] % MOD) : -1;
    }
}
