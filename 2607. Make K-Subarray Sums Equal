public class Solution {
    public long MakeSubKSumEqual(int[] arr, int k) {
        //Intuition:
        // In order for the sums to be equal the elements in side need to be equal in a striped pattern throughout the array.
        // Since we loop at the end of the array back to the beginning that pattern is not as long as "k" but gcd(n,k) so that it
        // can match the patter when looping back from the end.
        // The optimal item to change them too in a striped segment is the median of the segment.

        var g = GCD(k, arr.Length);

        var ans = 0L;
        for(var i=0; i<g; i++) {
            var stripe = new List<int>();
            for(var j=i; j<arr.Length; j += g) {
                stripe.Add(arr[j]);
            }

            stripe.Sort();
            var median = stripe[stripe.Count / 2];

            foreach(var val in stripe) {
                ans += Math.Abs(median - val);
            }
        }
    
        return ans;
    }

    private int GCD(int a, int b) {
        while(a != 0 && b != 0) {
            if(a > b) {
                a %= b;
            } else {
                b %= a;
            }
        }

        return  a | b; // short hand for returning the non-zero option of the two variables
    }
}
