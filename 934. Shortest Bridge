public class Solution {
    public int ShortestBridge(int[][] grid)
{
    int n = grid.Length;
    bool[][] visited = new bool[n][];
    for (int i = 0; i < n; i++)
    {
        visited[i] = new bool[n];
    }

    int[][] dirs = new int[][] {
    new int[] {0, 1},
    new int[] {0, -1},
    new int[] {1, 0},
    new int[] {-1, 0}
};

    Queue<int[]> queue = new Queue<int[]>();
    bool found = false;

    for (int i = 0; i < n; i++)
    {
        if (found) break;
        for (int j = 0; j < n; j++)
        {
            if (grid[i][j] == 1)
            {
                DFS(grid, visited, queue, dirs, i, j);
                found = true;
                break;
            }
        }
    }

    int steps = 0;
    while (queue.Count > 0)
    {
        int size = queue.Count;
        for (int i = 0; i < size; i++)
        {
            int[] curr = queue.Dequeue();
            int row = curr[0];
            int col = curr[1];

            for (int k = 0; k < 4; k++)
            {
                int newRow = row + dirs[k][0];
                int newCol = col + dirs[k][1];

                if (newRow >= 0 && newRow < n && newCol >= 0 && newCol < n && !visited[newRow][newCol])
                {
                    if (grid[newRow][newCol] == 1)
                    {
                        return steps;
                    }
                    visited[newRow][newCol] = true;
                    queue.Enqueue(new int[] { newRow, newCol });
                }
            }
        }
        steps++;
    }

    return -1;
}

private void DFS(int[][] grid, bool[][] visited, Queue<int[]> queue, int[][] dirs, int row, int col)
{
    int n = grid.Length;
    if (row < 0 || row >= n || col < 0 || col >= n || visited[row][col] || grid[row][col] != 1)
    {
        return;
    }

    visited[row][col] = true;
    queue.Enqueue(new int[] { row, col });

    foreach (int[] dir in dirs)
    {
        int newRow = row + dir[0];
        int newCol = col + dir[1];
        DFS(grid, visited, queue, dirs, newRow, newCol);
    }
}
}
