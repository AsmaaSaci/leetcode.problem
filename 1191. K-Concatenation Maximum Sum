public class Solution {
    public int KConcatenationMaxSum(int[] arr, int k) {
        int len = arr.Length, preMin = 0, maxSum = 0;
        int mod = (int)Math.Pow(10, 9)+7;
        int[] preSum = new int[len];
        for(int i = 0; i < len; i++)
        {
            preSum[i] = arr[i] + (i == 0 ? 0 : preSum[i-1]);
            maxSum = Math.Max(preSum[i] - preMin, maxSum);
            preMin = Math.Min(preMin, preSum[i]);
        }

        if(k == 1 || maxSum == 0) // k == 1 or all items in array <= 0
            return maxSum;

        // second loop:
        int sum = preSum[len-1];
        foreach(int cur in arr)
        {
            sum += cur;
            maxSum = Math.Max(maxSum, sum - preMin);
            preMin = Math.Min(preMin, sum);
        }

        long res = maxSum;
        if(preSum[len-1] > 0)
        {
            res += (long)(k-2)*(long)preSum[len-1];
        }

        res %= mod;
        return (int)res;
    }
}
