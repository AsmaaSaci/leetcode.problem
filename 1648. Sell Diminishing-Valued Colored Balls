public class Solution {
    public int MaxProfit(int[] inventory, int orders) {
                
        var (res, min, max) = (0L, 1L, (long) inventory.Max());

        while (min <= max) {

            long mid = min + (max - min) / 2;
            var (sum, ballsToSell) = (0L, 0L);

            foreach (var n in inventory) {

                if (n < mid) continue;
                
                // calc how many balls we can buy at current price
                var balls = n - mid + 1;

                // add number of balls at current price
                ballsToSell += balls;

                // calc total price using arithmetic progression formula
                sum += balls * (2 * mid + (balls - 1) * 1) / 2;
            }

            if (ballsToSell < orders) {
                max = mid - 1;
                continue;
            }

            (res, min) = (sum, mid + 1);

            // Remove excees balls if any
            res -= (ballsToSell - orders) * mid;
        }

        res %= 1_000_000_007;

        return (int) res;
    }
}
